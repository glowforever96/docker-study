# 2. 이미지와 컨테이너

## 이미지

서버에서 프로그램을 실행하기 위해선 소프트웨어적으로 세 가지가 필요

1. 기본 OS
2. 프로그램이 실행하기 위해 필요한 구성 요소 (Lib, Conf…)
3. 실행시킬 프로그램

<aside>
💡 Nginx 웹서버를 컨테이너로 실행했을 때 소프트웨어에 필요한 의존 요소를 설치하는 과정없이 어떻게 한번에 Nginx 프로그램을 실행할수 있었을까?

</aside>

**→ Nginx 이미지를 통해 컨테이너를 실행했기 때문**

**이미지 : 파일 시스템에 특정 시점을 저장해 놓은 압축 파일**

- 이미지는 제작 단계에서부터 소프트웨어 뿐만 아닌 실행하기 위해 필요한 모든 요소들을 미리 준비해 압축
- 컨테이너의 이미지는 백업이나 스냅샷보다 압축파일의 사이즈가 아주 작음
- 이미지는 Nginx 이미지처럼 다른 사람이 만든 이미지를 다운 받아 사용 가능
- 직접 이미지를 제작도 가능

## 이미지와 컨테이너

**이미지**

- 실행 가능한 소프트웨어 + 실행에 필요한 환경
- 디스크 공간 차지

**컨테이너**

- 실행 상태의 이미지
- 이미지 1 : N 컨테이너
- 컨테이너로 실행시 CPU, MEM 등의 리소스 사용
- 컨테이너간 리소스 격리
- 실행 시 이미지를 복사해 격리된 디스크 공간 생성
- 컨테이너 실행시 프로세스도 함께 실행

1. **도커 이미지 조회**

```docker
docker image ls (이미지명)
```

![1.png](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/1.png)

예시)

```docker
docker image ls nginx
```

여러개의 이미지가 있을때 nginx 이미지만 조회 가능

- repository : 이미지 이름
- tag : 이미지의 버전
- image id : 이미지의 고유한 아이디

1. **하나의 이미지로 여러 컨테이너 실행**

```docker
docker run -d --name {컨테이너명} 이미지명
```

- -d : 컨테이너의 로그가 터미널을 점유하지 않고 백그라운드 실행

예시)

```docker
docker run -d --name multinginx1 nginx
docker run -d --name multinginx2 nginx
docker run -d --name multinginx3 nginx
```

1. **실행 중인 컨테이너 리스트 조회**

```docker
docker ps
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled.png)

1. **실행 중인 컨테이너 삭제**

```docker
docker rm -f
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%201.png)

여러개의 컨테이너도 한번에 삭제 가능

## 이미지의 메타데이터(Metadata)

메타데이터 : 데이터에 대한 데이터 → 이미지에 대한 정보를 기술하는 데이터

**하나의 이미지는 실제로 압축된 파일과 파일의 정보가 저장된 메타데이터로 구성되어 있음**

이미지 아이디와 이름, 파일 사이즈 등의 정보가 담김, 중요한건 env와 cmd 필드

- env : 소프트웨어가 실행할 때 사용할 설정 정보
- cmd : 컨테이너 실행 시 프로세스 실행 명령어 지정
    - 이미지를 컨테이너로 실행할 때 CMD에 있는 명령어를 통해 어떤 프로그램을 실행할지를 메타데이터에서 결정
- 컨테이너를 실행할 때 새로운 값으로 덮어 쓰기도 가능

1. **이미지의 세부 정보 조회**

```docker
docker image inspect 이미지명
```

예시)

```docker
docker image inspect nginx
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%202.png)

1. **컨테이너의 세부 정보 조회**

```docker
docker container inspect 컨테이너명
```

예시)

```docker
docker container inspect defaultCmd
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%203.png)

1. **컨테이너 실행 시 메타데이터의 cmd 덮어쓰기**

```docker
docker run 이미지명 (실행명령)
```

예시)

```docker
docker run --name customCmd nginx cat usr/share/nginx/html/index.html
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%204.png)

이때  docker ps 명령어로 실행중인 컨테이너들을 살펴보면 customCmd는 보이지 않음 → cat 명령어는 일회성 프로세스, 명령이 종료되는 순간 컨테이너도 함께 종료

- `docker ps -a` : 종료된 컨테이너 포함 모든 컨테이너 조회

<aside>
💡 **docker run -d 이미지명 (컨테이너 백그라운드 실행)**
- d 옵션 추가시 : 지속적으로 실행되는 데몬 프로그램을 실행할 때 적합
- d 옵션 제거시 : 실행 후 종료되는 프로그램에 적합, 실시간 로그 확인할 경우

</aside>

- docker pull 이미지명 : 이미지 다운로드

1. **컨테이너 실행 시 메타데이터의 env 덮어쓰기**

```docker
docker run --env KEY=VALUE 이미지명
```

예시)

기본 이미지의 메타데이터를 사용해 컨테이너 실행

```docker
docker run -d -p 8080:3000 --name defaultColorApp devwikirepo/envnodecolorapp
```

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%205.png)

새롭게 env 필드를 덮어쓰기한 컨테이너 실행

```docker
docker run -d -p 8081:3000 --name blueColorApp --env COLOR=blue devwikirepo/envnodecolorapp
```

이미지 메타데이터 env 필드의 COLOR값이 blue로 바뀜

![Untitled](2%20%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%AA%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%20f0bae3b8ff524b808699ae398c72914e/Untitled%206.png)